#!/usr/bin/env ruby

require 'uuid'
require 'wip/create'

unless ENV['WORKSPACE'] and File.directory?(ENV['WORKSPACE'])
  puts "WORKSPACE must be set"
  exit 1
end

WORKSPACE = ENV['WORKSPACE']

if ARGV.empty?
  puts "sip is required"
  exit 2
end

sip = Sip.new ARGV.shift

begin
  name = UUID.new.generate
  path = File.join WORKSPACE, name
  aip = Wip.make_from_sip path, sip
  puts "#{name} successfully submitted"
rescue => e
  puts e.message
  puts e.backtrace
  exit 3
end
