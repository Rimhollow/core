#!/usr/bin/env ruby

$LOAD_PATH.unshift File.join(File.dirname(__FILE__), '..', 'lib')

require 'daitss'

include Daitss

id = ARGV.shift or raise "no wip given"
wip = archive.workspace[id] or raise "wip not in workspace"

begin
  wip.package.log "#{wip.task} started"
  wip.start
  wip.package.log "#{wip.task} finished"
  FileUtils.rm_r wip.path unless wip.snafu?
rescue => e
  wip.snafu = e
  wip.package.log "#{wip.task} snafu", :notes => e.message.split("\n\n")[0]
  exit 1
end
