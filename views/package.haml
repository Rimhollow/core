%h1
  %span.package
    = @package.id
  = ": "
  - case @package.status
  - when 'ingesting'
    %span.status.ingesting
      %a{:href=>"/workspace/#{@package.wip.id}"}
        = @package.status
  - when 'stashed'
    %span.status.stashed
      %a{:href=>"/stashspace/#{@package.stashed_wip.bin.url_name}/#{@package.stashed_wip.id}"}
        = @package.status
  - when 'rejected'
    %span.status.rejected
      = @package.status
  - else
    = @package.status

%table
  %tr
    %th sip name
    %th account
    %th project
  %tr
    %td= @package.sip.name
    %td= @package.project.account.id
    %td= @package.project.id

%h2 events

%table
  %tr
    %th type
    %th time
    %th notes
    %th agent
  - @package.events.each do |e|
    %tr
      %td= e.name
      %td= e.timestamp.pragma
      %td= e.notes
      %td= e.agent.id

- if @package.aip
  %h2 stashed

  - if @package.stashed_wip
    %a{:href=>"/stashspace/#{@package.stashed_wip.bin.url_name}/#{@package.stashed_wip.id}"}
      = @package.stashed_wip.task

  - else
    no jobs stashed

  %h2 requests

  %form{:action => '/request', :method => 'POST'}
    %br
    %select{:name=>'type'}
      %option= 'disseminate'
      %option= 'withdraw'
      %option= 'peek'
    %br
    %input{:type => 'hidden', :name => 'ieid', :value=>"#{@package.id}"}
    %input{:type => 'submit', :value => 'Submit'}


  - if @package.requests.any?
    %table
      %tr
        %th type
        %th time
        %th authorized?
        %th request submitter
        %th status
        %th delete
      - @package.requests.each do |r|
        %tr
          %td= r.request_type
          %td= r.timestamp.pragma
          %td= r.is_authorized ? "yes" : "no"
          %td= r.operations_agent.identifier
          %td= r.status
          %td
            - if r.status != :released_to_workspace
              %a{:href => "/delete_request/#{@package.id}/#{r.request_type}"}
                delete

  - aip = @package.aip

  %h2 aip

  %h3
    %a{:href=>"/package/#{@package.id}/descriptor"}
      xml descriptor

  %table
    %tr
      %th copy url
      %td
        %a{ :href => aip.copy.url }
          = aip.copy.url
    %tr
      %th copy size
      %td= aip.copy.size
    %tr
      %th copy sha1
      %td= aip.copy.sha1
    %tr
      %th copy md5
      %td= aip.copy.md5
    %tr
      %th number of datafiles
      %td= aip.datafile_count
