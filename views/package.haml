%h1
  %span.package
    = @package.id
  = ": "
  - case @package.status
  - when 'ingesting'
    %span.status.ingesting
      %a{:href=>"/workspace/#{@package.wip.id}"}
        = @package.status
  - when 'stashed'
    %span.status.stashed
      %a{:href=>"/stashspace/#{@package.stashed_wip.bin.url_name}/#{@package.stashed_wip.id}"}
        = @package.status
  - when 'rejected'
    %span.status.rejected
      = @package.status
  - else
    = @package.status

%table
  %tr
    %th sip name
    %th account
    %th project
  %tr
    %td= @package.sip.name
    %td= @package.project.account.id
    %td= @package.project.id

%h2 events

%table
  %tr
    %th type
    %th time
    %th notes
    %th agent
  - @package.events.each do |e|
    %tr
      %td= e.name
      %td= e.timestamp.pragma
      %td= e.notes
      %td= e.agent.id

- if @ingest_time
  %h2 ingest stats

  %table
    %tr
      %th name
      %th value
    %tr
      %td elapsed time
      %td= @ingest_time

- if @package.aip

  #request
    %h2 requests

    - if @package.requests.any?
      %table
        %tr
          %th type
          %th position
          %th time
          %th authorized
          %th request submitter
          %th status
          %th &nbsp;

        - @package.requests.each do |r|
          %tr
            %td= r.type
            %td= r.position
            %td= r.timestamp.pragma
            %td= r.is_authorized ? "yes" : "no"
            %td= r.agent.id
            %td= r.status
            %td
              %form{:action => "/package/#{@package.id}/request/#{r.id}", :method => 'POST'}
                %input{:type => 'hidden', :name => 'task', :value => 'delete'}
                %input{:type => 'submit', :value => 'Cancel'}

    %form{:action => "/package/#{@package.id}/request", :method => 'POST'}
      %select{:name=>'type'}
        %option= 'disseminate'
        %option= 'withdraw'
        %option= 'peek'
      %input{:type => 'submit', :value => 'Request'}


  - aip = @package.aip

  %h2 aip

  %table
    %tr
      %th descriptor
      %td
        %a{:href=>"/package/#{@package.id}/descriptor"}
          = @package.id + ".xml"
    %tr
      %th copy url
      %td
        %a{ :href => aip.copy.url }
          = @package.id + ".tar"
    %tr
      %th copy size
      %td= aip.copy.size
    %tr
      %th copy sha1
      %td= aip.copy.sha1
    %tr
      %th copy md5
      %td= aip.copy.md5
    %tr
      %th number of datafiles
      %td= aip.datafile_count
